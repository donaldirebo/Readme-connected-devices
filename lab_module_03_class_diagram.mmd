classDiagram
    %% Interfaces
    class IDataMessageListener {
        <<interface>>
        +handleActuatorCommandMessage(data)
        +handleActuatorCommandResponse(data)
        +handleIncomingMessage(resourceEnum, msg)
        +handleSensorMessage(data)
        +handleSystemPerformanceMessage(data)
    }

    %% Data Layer - Base and Container Classes
    class BaseIotData {
        -name: str
        -typeID: int
        -locationID: str
        -timeStamp: str
        -statusCode: int
        +getName() str
        +getTypeID() int
        +getLocationID() str
        +updateTimeStamp()
        +updateData(data)
        #_handleUpdateData(data)*
    }

    class SensorData {
        -value: float
        +getValue() float
        +setValue(val)
        #_handleUpdateData(data)
    }

    class ActuatorData {
        -value: float
        -command: int
        -stateData: str
        -isResponse: bool
        +getValue() float
        +getCommand() int
        +getStateData() str
        +isResponseFlagEnabled() bool
        +setValue(val)
        +setCommand(cmd)
        +setStateData(data)
        +setAsResponse()
        #_handleUpdateData(data)
    }

    class SystemPerformanceData {
        -cpuUtil: float
        -memUtil: float
        +getCpuUtilization() float
        +getMemoryUtilization() float
        +setCpuUtilization(val)
        +setMemoryUtilization(val)
        #_handleUpdateData(data)
    }

    %% Simulation Layer - Sensor Tasks
    class BaseSensorSimTask {
        -name: str
        -typeID: int
        -dataSet: SensorDataSet
        -useRandomizer: bool
        -minVal: float
        -maxVal: float
        -latestSensorData: SensorData
        +generateTelemetry() SensorData
        +getTelemetryValue() float
        +getName() str
        +getTypeID() int
    }

    class HumiditySensorSimTask {
        +__init__(dataSet)
    }

    class PressureSensorSimTask {
        +__init__(dataSet)
    }

    class TemperatureSensorSimTask {
        +__init__(dataSet)
    }

    class SensorDataGenerator {
        +generateDailyEnvironmentHumidityDataSet() SensorDataSet
        +generateDailyEnvironmentPressureDataSet() SensorDataSet
        +generateDailyIndoorTemperatureDataSet() SensorDataSet
    }

    %% Simulation Layer - Actuator Tasks
    class BaseActuatorSimTask {
        -name: str
        -typeID: int
        -simpleName: str
        -lastKnownCommand: int
        -lastKnownValue: float
        -lastKnownState: str
        -latestActuatorResponse: ActuatorData
        +updateActuator(data) ActuatorData
        +getSimpleName() str
        #_activateActuator(val, stateData) int
        #_deactivateActuator(val, stateData) int
    }

    class HumidifierActuatorSimTask {
        +__init__()
    }

    class HvacActuatorSimTask {
        +__init__()
    }

    %% Manager Layer
    class SensorAdapterManager {
        -configUtil: ConfigUtil
        -scheduler: BackgroundScheduler
        -pollRate: int
        -locationID: str
        -dataMsgListener: IDataMessageListener
        -humidityAdapter: HumiditySensorSimTask
        -pressureAdapter: PressureSensorSimTask
        -tempAdapter: TemperatureSensorSimTask
        -dataGenerator: SensorDataGenerator
        +startManager() bool
        +stopManager() bool
        +handleTelemetry()
        +setDataMessageListener(listener)
        -_initEnvironmentalSensorTasks()
    }

    class ActuatorAdapterManager {
        -configUtil: ConfigUtil
        -locationID: str
        -dataMsgListener: IDataMessageListener
        -humidifierActuator: HumidifierActuatorSimTask
        -hvacActuator: HvacActuatorSimTask
        +sendActuatorCommand(data) ActuatorData
        +setDataMessageListener(listener)
        -_initEnvironmentalActuationTasks()
    }

    class SystemPerformanceManager {
        -scheduler: BackgroundScheduler
        -dataMsgListener: IDataMessageListener
        +startManager() bool
        +stopManager() bool
        +handleTelemetry()
        +setDataMessageListener(listener)
    }

    %% Application Layer
    class DeviceDataManager {
        -configUtil: ConfigUtil
        -sysPerfMgr: SystemPerformanceManager
        -sensorAdapterMgr: SensorAdapterManager
        -actuatorAdapterMgr: ActuatorAdapterManager
        -handleTempChangeOnDevice: bool
        -triggerHvacTempFloor: float
        -triggerHvacTempCeiling: float
        -actuatorResponseCache: dict
        -sensorDataCache: dict
        +startManager()
        +stopManager()
        +handleActuatorCommandMessage(data) ActuatorData
        +handleActuatorCommandResponse(data) bool
        +handleIncomingMessage(resourceEnum, msg) bool
        +handleSensorMessage(data) bool
        +handleSystemPerformanceMessage(data) bool
        -_handleSensorDataAnalysis(data)
        -_handleIncomingDataAnalysis(msg)
        -_handleUpstreamTransmission(resourceName, msg)
    }

    class ConstrainedDeviceApp {
        -devDataMgr: DeviceDataManager
        -isStarted: bool
        +startApp()
        +stopApp(code)
        +isAppStarted() bool
    }

    class ConfigUtil {
        +getBoolean(section, key) bool
        +getInteger(section, key) int
        +getFloat(section, key) float
        +getProperty(section, key) str
    }

    %% Relationships - Inheritance
    BaseIotData <|-- SensorData
    BaseIotData <|-- ActuatorData
    BaseIotData <|-- SystemPerformanceData

    BaseSensorSimTask <|-- HumiditySensorSimTask
    BaseSensorSimTask <|-- PressureSensorSimTask
    BaseSensorSimTask <|-- TemperatureSensorSimTask

    BaseActuatorSimTask <|-- HumidifierActuatorSimTask
    BaseActuatorSimTask <|-- HvacActuatorSimTask

    IDataMessageListener <|.. DeviceDataManager

    %% Relationships - Composition
    ConstrainedDeviceApp *-- DeviceDataManager
    DeviceDataManager *-- SensorAdapterManager
    DeviceDataManager *-- ActuatorAdapterManager
    DeviceDataManager *-- SystemPerformanceManager

    SensorAdapterManager *-- HumiditySensorSimTask
    SensorAdapterManager *-- PressureSensorSimTask
    SensorAdapterManager *-- TemperatureSensorSimTask
    SensorAdapterManager *-- SensorDataGenerator

    ActuatorAdapterManager *-- HumidifierActuatorSimTask
    ActuatorAdapterManager *-- HvacActuatorSimTask

    %% Relationships - Dependencies
    BaseSensorSimTask ..> SensorData : creates
    BaseActuatorSimTask ..> ActuatorData : processes
    SensorDataGenerator ..> BaseSensorSimTask : provides data to
    
    SensorAdapterManager ..> IDataMessageListener : callbacks
    ActuatorAdapterManager ..> IDataMessageListener : callbacks
    SystemPerformanceManager ..> IDataMessageListener : callbacks
    
    DeviceDataManager ..> ActuatorData : processes
    DeviceDataManager ..> SensorData : processes
    DeviceDataManager ..> SystemPerformanceData : processes

    SensorAdapterManager ..> ConfigUtil : uses
    ActuatorAdapterManager ..> ConfigUtil : uses
    DeviceDataManager ..> ConfigUtil : uses

    %% Notes
    note for IDataMessageListener "Callback interface for\ndata message routing"
    note for DeviceDataManager "Central coordinator\nImplements business logic\nPerforms data analytics"
    note for SensorAdapterManager "Uses APScheduler\nfor periodic data collection"
    note for BaseSensorSimTask "Template for sensor simulation\nSupports random or dataset mode"